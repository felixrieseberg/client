<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>nitrogen.CommandManager - nitrogen</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="https://api.nitrogen.io/logo.png" title="nitrogen"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.20</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/nitrogen.Agent.html">nitrogen.Agent</a></li>
            
                <li><a href="../classes/nitrogen.CommandManager.html">nitrogen.CommandManager</a></li>
            
                <li><a href="../classes/nitrogen.Device.html">nitrogen.Device</a></li>
            
                <li><a href="../classes/nitrogen.Message.html">nitrogen.Message</a></li>
            
                <li><a href="../classes/nitrogen.Principal.html">nitrogen.Principal</a></li>
            
                <li><a href="../classes/nitrogen.Service.html">nitrogen.Service</a></li>
            
                <li><a href="../classes/nitrogen.Session.html">nitrogen.Session</a></li>
            
                <li><a href="../classes/nitrogen.User.html">nitrogen.User</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1>nitrogen.CommandManager Class</h1>
<div class="box meta">
    

    

    
        <div class="foundat">
            Defined in: <a href="../files/lib_commandManager.js.html#l3"><code>lib&#x2F;commandManager.js:3</code></a>
        </div>
    

    

    
</div>



<div class="box intro">
    <p>The CommandManager object provides infrastructure for command processing within Nitrogen. Commands are messages that are issued
with the intent of changing the state of a principal in the system. The CommandManager&#39;s role is to watch that principal&#39;s message
stream and effect state changes on the device it is managing based on these commands and their context in the stream. The CommandManager
is always subclassed into a class that handles a specific type of command. This subclass is responsible for providing a set of functions
that define how the message stream should be interpreted and acted on: executeActiveCommands, isRelevant, isCommand, obsoletes. See each
function in this class for more information on what an implementation of these functions should provide.</p>
<p>An example of how a SwitchManager subclass is used to control a light in a device application looks like this:</p>
<p>service.connect(light, function(err, session, light) {
    if (err) return console.log(&#39;failed to connect light: &#39; + err);</p>
<pre class="code prettyprint"><code>var switchManager = new n2.SwitchManager(light);
switchManager.start(session, { $or: [ { to: light.id }, { from: light.id } ] }, function(err) {
   if (err) return console.log(&#39;switchManager failed to start: &#39; + err);
});</code></pre>
<p>});</p>

</div>



<div id="classdocs" class="tabview">
    <ul class="api-class-tabs">
        <li class="api-class-tab index"><a href="#index">Index</a></li>

        
            <li class="api-class-tab methods"><a href="#methods">Methods</a></li>
        
        
        
        
    </ul>

    <div>
        <div id="index" class="api-class-tabpanel index">
            <h2 class="off-left">Item Index</h2>

            
                <div class="index-section methods">
                    <h3>Methods</h3>

                    <ul class="index-list methods">
                        
                            <li class="index-item method">
                                <a href="#method_activeCommands">activeCommands</a>

                                
                                
                            </li>
                        
                            <li class="index-item method private">
                                <a href="#method_collapse">collapse</a>

                                
                                
                            </li>
                        
                            <li class="index-item method private">
                                <a href="#method_execute">execute</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_executeQueue">executeQueue</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_isCommand">isCommand</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_isRelevant">isRelevant</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_lastActiveCommand">lastActiveCommand</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_obsoletes">obsoletes</a>

                                
                                
                            </li>
                        
                            <li class="index-item method private">
                                <a href="#method_process">process</a>

                                
                                
                            </li>
                        
                            <li class="index-item method">
                                <a href="#method_start">start</a>

                                
                                
                            </li>
                        
                    </ul>
                </div>
            

            

            

            
        </div>

        
            <div id="methods" class="api-class-tabpanel">
                <h2 class="off-left">Methods</h2>

                
                    <div id="method_activeCommands" class="method item">
    <h3 class="name"><code>activeCommands</code></h3>

    
        <span class="paren">()</span>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l32"><code>lib&#x2F;commandManager.js:32</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Return the array of commands that are currently active for this manager.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_collapse" class="method item private">
    <h3 class="name"><code>collapse</code></h3>

    
        <span class="paren">()</span>
    

    

    

    
        <span class="flag private">private</span>
    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l49"><code>lib&#x2F;commandManager.js:49</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Reduce the current message queue to the set of active commands by obsoleting completed and expired commands.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_execute" class="method item private">
    <h3 class="name"><code>execute</code></h3>

    
        <span class="paren">()</span>
    

    

    

    
        <span class="flag private">private</span>
    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l95"><code>lib&#x2F;commandManager.js:95</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Executes the currently active command queue.  If the next command&#39;s timestamp occurs in the future, setup a timeout to retry then.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_executeQueue" class="method item">
    <h3 class="name"><code>executeQueue</code></h3>

    
        <span class="paren">()</span>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l127"><code>lib&#x2F;commandManager.js:127</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Executes the active commands in the message queue. Should be implemented by subclasses of CommandManager.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_isCommand" class="method item">
    <h3 class="name"><code>isCommand</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>message</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l140"><code>lib&#x2F;commandManager.js:140</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Return true if this message is a command that this CommandManager can process. Should be implemented by subclasses of CommandManager.</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">message</code>
                        <span class="type"><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
                    

                    

                    <div class="param-description">
                        <p>The message to test for relevance.</p>

                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    

    
</div>

                
                    <div id="method_isRelevant" class="method item">
    <h3 class="name"><code>isRelevant</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>message</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l133"><code>lib&#x2F;commandManager.js:133</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Return true if this message is relevant to the CommandManager. Should be implemented by subclasses of CommandManager.</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">message</code>
                        <span class="type"><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
                    

                    

                    <div class="param-description">
                        <p>The message to test for relevance.</p>

                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    

    
</div>

                
                    <div id="method_lastActiveCommand" class="method item">
    <h3 class="name"><code>lastActiveCommand</code></h3>

    
        <span class="paren">()</span>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l147"><code>lib&#x2F;commandManager.js:147</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Return the last active command in the message queue as ordered by timestamp.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_obsoletes" class="method item">
    <h3 class="name"><code>obsoletes</code></h3>

    
        <div class="args">
            <span class="paren">(</span><ul class="args-list inline commas">
            
                <li class="arg">
                    
                        <code>downstreamMsg</code>
                    
                </li>
            
                <li class="arg">
                    
                        <code>upstreamMsg</code>
                    
                </li>
            
            </ul><span class="paren">)</span>
        </div>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l158"><code>lib&#x2F;commandManager.js:158</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Returns true if the given message upstream of the given downstream message is obsoleted by the downstream message.
Should be overridden by subclasses to provide command type specific obsoletion logic.  Overrides should start 
their implementation by calling this function for base functionality:</p>
<p>if (CommandManager.obsoletes(downstreamMsg, upstreamMsg)) return true;</p>

    </div>

    
        <div class="params">
            <h4>Parameters:</h4>

            <ul class="params-list">
            
                <li class="param">
                    
                        <code class="param-name">downstreamMsg</code>
                        <span class="type"><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
                    

                    

                    <div class="param-description">
                        <p>The downstream message that potentially obsoletes the upstream message.</p>

                    </div>

                    
                </li>
            
                <li class="param">
                    
                        <code class="param-name">upstreamMsg</code>
                        <span class="type"><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object" class="crosslink external" target="_blank">Object</a></span>
                    

                    

                    <div class="param-description">
                        <p>The upstream message that is potentially obsoleted by the downstream message.</p>

                    </div>

                    
                </li>
            
            </ul>
        </div>
    

    

    
</div>

                
                    <div id="method_process" class="method item private">
    <h3 class="name"><code>process</code></h3>

    
        <span class="paren">()</span>
    

    

    

    
        <span class="flag private">private</span>
    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l179"><code>lib&#x2F;commandManager.js:179</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Process new message in this principal&#39;s message stream:  adds it to the messageQueue, collapses the current message stream,
and sets up timeout to handle expiration of this message and the subsequent collapse that should occur.</p>

    </div>

    

    

    
</div>

                
                    <div id="method_start" class="method item">
    <h3 class="name"><code>start</code></h3>

    
        <span class="paren">()</span>
    

    

    

    

    

    

    

    

    <div class="meta">
        
            
                
                <p>
                
                Defined in
                
            
        
        
        <a href="../files/lib_commandManager.js.html#l214"><code>lib&#x2F;commandManager.js:214</code></a>
        
        </p>


        

        
    </div>

    <div class="description">
        <p>Starts command processing on the message stream using the principal&#39;s session. It fetches all the current messages, processes them, and then
starts execution. It also establishes a subscription to handle new messages and automatically executes them as they are received.</p>

    </div>

    

    

    
</div>

                
            </div>
        

        

        

        
    </div>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
